import{_ as w,b as h,o as c,c as l,a as t,t as d,j as u,d as _,k,F as y,i as S,n as z,g as T,w as f,v as g,l as C,h as v}from"./index-193cd5e6.js";const I={data(){return{isAdmin:!1,isModerator:!1,isUser:!0,raportFile:"",response:"",output:"",currentUserId:"",newComments:{},redDate:!1,statusSort:"0",rodzajSort:"0",priorytetSort:"0",editingNow:!1}},mounted(){this.checkAction(),this.getTickets(),this.getRaportLink(),this.getUserRole()},methods:{checkAction(){let e=localStorage.getItem("actionDone");localStorage.removeItem("actionDone");let s=localStorage.getItem("deleteDone");localStorage.removeItem("deleteDone");let n=localStorage.getItem("commentAdded");localStorage.removeItem("commentAdded");let m=localStorage.getItem("commentEdit");localStorage.removeItem("commentEdit");let i=localStorage.getItem("deleteComment");localStorage.removeItem("deleteComment"),e?this.setNotificationDone("Status został zmieniony"):s?this.setNotificationError("Zgłoszenie zostało usunięte"):n?this.setNotificationDone("Komentarz został dodany"):m?this.setNotificationDone("Komentarz został edytowany"):i&&this.setNotificationDone("Komentarz został usunięty")},setNotificationDone(e){this.createTicketActionTime&&clearTimeout(this.createTicketActionTime),this.response=e,this.$refs.actionDone.style.top="100px",this.$refs.actionDone.style.opacity=1,this.createTicketActionTime=setTimeout(()=>{this.$refs.actionDone.style.top="-50px",this.$refs.actionDone.style.opacity=0},3e3)},setNotificationError(e){this.createTicketErrorTime&&clearTimeout(this.createTicketErrorTime),this.response=e,this.$refs.createCommentError.style.top="100px",this.$refs.createCommentError.style.opacity=1,this.createTicketErrorTime=setTimeout(()=>{this.$refs.createCommentError.style.top="-50px",this.$refs.createCommentError.style.opacity=0},3e3)},checkStatusSort(e){return this.statusSort==0?!0:e.ticketStatusId==this.statusSort},checkRodzajSort(e){return this.rodzajSort==0?!0:e.ticketTypeId==this.rodzajSort},checkPriorytetSort(e){return this.priorytetSort==0?!0:e.priorityId==this.priorytetSort},async getTickets(){const e=localStorage.getItem("jwtToken");if(e)try{const s=await h.get("https://servicedeskinz2023.azurewebsites.net/api/tickets",{headers:{Authorization:"Bearer "+e}}).then(n=>{this.output=n.data})}catch(s){console.log(s)}},getUserRole(){const e=localStorage.getItem("jwtToken"),s=JSON.parse(atob(e.split(".")[1]));this.currentUserId=s["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"];const n=s["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"];n==="Administrator"?this.isAdmin=!0:this.isAdmin=!1,n==="Moderator"?this.isModerator=!0:this.isModerator=!1,n==="User"?this.isUser=!0:this.isUser=!1},async getRaportLink(){const e=localStorage.getItem("jwtToken");if(e)try{const s=await h.get("https://servicedeskinz2023.azurewebsites.net/api/pdf/generate-report",{headers:{Authorization:"Bearer "+e}}).then(n=>{this.raportFile=n.config.url})}catch(s){console.log(s)}},async addComment(e){const s=localStorage.getItem("jwtToken");if(s)if(!this.newComments[e])this.createCommentError("Wypełnij pole z komentarzem.");else try{const n={content:this.newComments[e]},m=await h.post(`https://servicedeskinz2023.azurewebsites.net/api/ticket/${e}/comment`,n,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+s}}).then(()=>{localStorage.setItem("commentAdded",!0),window.location.reload()})}catch(n){console.log(n)}},showInfo(e){e.target.closest("section").lastElementChild.style.maxHeight=="1000px"?(e.target.closest("section").lastElementChild.style.maxHeight="0px",e.target.closest("section").firstElementChild.lastElementChild.firstElementChild.style.transform="rotate(0deg)"):(e.target.closest("section").lastElementChild.style.maxHeight="1000px",e.target.closest("section").firstElementChild.lastElementChild.firstElementChild.style.transform="rotate(180deg)")},daysLeftFormat(e){let[s,n]=e.split("."),[m,i,a]=n.split(":");return s=s.includes(":")?s.split(":")[0]:s,`${s} dni ${m}h ${i}min`},formatISODateToDMY(e){const s=new Date(e),n=s.getDate().toString().padStart(2,"0"),m=(s.getMonth()+1).toString().padStart(2,"0"),i=s.getFullYear();return`${n}/${m}/${i}`},formatISOTimeToHM(e){const s=new Date(e),n=s.getHours().toString().padStart(2,"0"),m=s.getMinutes().toString().padStart(2,"0");return n+":"+m},showComments(e){e.target.parentElement.nextElementSibling.style.maxHeight=="500px"?(e.target.parentElement.nextElementSibling.style.maxHeight="0px",e.target.lastElementChild.style.rotate="0deg"):(e.target.parentElement.nextElementSibling.style.maxHeight="500px",e.target.lastElementChild.style.rotate="180deg")},titleFormatingLength(e){return e.length<20?e:e.slice(0,19)+" ..."},statusSet(e){switch(e){case 1:return"Nowy";case 2:return"W realizacji";case 3:return"Oczekujący";case 4:return"Zamknięty";default:return"-"}},typeSet(e){switch(e){case 1:return"Software";case 2:return"Hardware";case 3:return"Malware";default:return"-"}},prioritySet(e){switch(e){case 1:return"Niski";case 2:return"Średni";case 3:return"Wysoki";default:return"-"}},createCommentError(e){this.createTicketErrorTime&&clearTimeout(this.createTicketErrorTime),this.response=e,this.$refs.createCommentError.style.top="100px",this.$refs.createCommentError.style.opacity=1,this.createTicketErrorTime=setTimeout(()=>{this.$refs.createCommentError.style.top="-50px",this.$refs.createCommentError.style.opacity=0},3e3)},async changeStatusTicket(e,s,n){const m=localStorage.getItem("jwtToken");try{const i=await h.post(`https://servicedeskinz2023.azurewebsites.net/api/tickets/update/${e}`,{id:s},{headers:{Authorization:"Bearer "+m}}).then(()=>{localStorage.setItem("actionDone",n),window.location.reload()})}catch(i){console.log(i)}},async deleteTicket(e){const s=localStorage.getItem("jwtToken");try{const n=await h.delete(`https://servicedeskinz2023.azurewebsites.net/api/tickets/${e}`,{headers:{Authorization:"Bearer "+s}}).then(()=>{localStorage.setItem("deleteDone",!0),window.location.reload()})}catch(n){console.log(n)}},async deleteComments(e,s){const n=localStorage.getItem("jwtToken");try{const m=await h.delete(`https://servicedeskinz2023.azurewebsites.net/api/ticket/${e}/comment/${s}`,{headers:{Authorization:"Bearer "+n}}).then(()=>{localStorage.setItem("deleteComment",!0),window.location.reload()})}catch(m){console.log(m)}},async editComment(e,s,n){const m=localStorage.getItem("jwtToken");try{const i=await h.put(`https://servicedeskinz2023.azurewebsites.net/api/ticket/${e}/comment/${s}`,{content:n},{headers:{Authorization:"Bearer "+m}}).then(()=>{localStorage.setItem("commentEdit",!0),window.location.reload()})}catch(i){console.log(i)}}}},E={class:"tickets"},j={class:"tickets__heading"},D=t("h1",null,"Zgłoszenia",-1),x=["href"],b={key:0,class:"tickets__title-list"},N=t("p",null,"Id",-1),A=t("p",null,"Tytuł",-1),U=v('<option value="0">Status</option><option value="1">Nowy</option><option value="2">W realizacji</option><option value="3">Oczekujący</option><option value="4">Zakmięty</option>',5),M=[U],V=t("option",{value:"0"},"Rodzaj",-1),B=t("option",{value:"1"},"Software",-1),H=t("option",{value:"2"},"Hardware",-1),O=t("option",{value:"3"},"Malware",-1),F=[V,B,H,O],L=t("option",{value:"0"},"Priorytet",-1),R=t("option",{value:"1"},"Niski",-1),P=t("option",{value:"2"},"Średni",-1),W=t("option",{value:"3"},"Wysoki",-1),Z=[L,R,P,W],Y=t("p",null,"Termin",-1),K=t("p",null,null,-1),J={key:1,class:"empty-tickets"},q={class:"tickets__tickets-list"},G={key:0,class:"tickets__tickets-list-li"},Q=t("p",{class:"arrow"},[t("span",{class:"material-symbols-outlined"},"expand_more")],-1),X={class:"tickets__tickets-list-info"},$={key:0,class:"tickets__tickets-list-info-admin-bar"},tt=["onClick"],et=["onClick"],st=["onClick"],ot=["onClick"],it={class:"tickets__tickets-list-info-user-ceated"},nt=t("span",null,"Utworzono przez: ",-1),rt={class:"tickets__tickets-list-info-created"},at=t("span",null,"Data utworzenia:",-1),ct={class:"tickets__tickets-list-info-title"},lt=t("span",null,"Tytuł: ",-1),dt={class:"tickets__tickets-list-info-description"},mt=t("span",null,"Opis: ",-1),ut={key:1,class:"tickets__tickets-list-info-com"},ht=t("span",{class:"material-symbols-outlined"},"expand_more",-1),_t={key:2,class:"tickets__tickets-list-info-comments"},pt={class:"tickets__tickets-list-info-comments-list"},kt={class:"tickets__tickets-list-info-comments-list-box"},ft={class:"tickets__tickets-list-info-comments-list-user"},gt={class:"tickets__tickets-list-info-comments-list-box-dates"},yt={class:"tickets__tickets-list-info-comments-list-time"},St={class:"tickets__tickets-list-info-comments-list-date"},wt=["onSubmit"],zt=["onUpdate:modelValue"],Tt=t("div",null,[t("button",{class:""},"Edytuj")],-1),Ct={key:2,class:"tickets__tickets-list-info-comments-list-methods"},vt=["onClick"],It=["onClick"],Et=["onSubmit"],jt=["onUpdate:modelValue"],Dt=t("button",null,[t("p",null,"Dodaj komentarz")],-1),xt={key:3,class:"no-comments"},bt=["onSubmit"],Nt=["onUpdate:modelValue"],At=t("button",null,[t("p",null,"Dodaj komentarz")],-1);function Ut(e,s,n,m,i,a){return c(),l("div",E,[t("p",{class:"tickets__error",ref:"createCommentError"},d(i.response),513),t("p",{class:"tickets__action",ref:"actionDone"},d(i.response),513),t("div",j,[D,i.isUser?u("",!0):(c(),l("a",{key:0,download:"",href:i.raportFile},"Pobierz raport zgłoszeń",8,x))]),i.output.length>=1?(c(),l("ul",b,[N,A,t("p",null,[_(t("select",{name:"status",id:"status","onUpdate:modelValue":s[0]||(s[0]=o=>i.statusSort=o)},M,512),[[k,i.statusSort]])]),t("p",null,[_(t("select",{name:"rodzaj",id:"rodzaj","onUpdate:modelValue":s[1]||(s[1]=o=>i.rodzajSort=o)},F,512),[[k,i.rodzajSort]])]),t("p",null,[_(t("select",{name:"priorytet",id:"priorytet","onUpdate:modelValue":s[2]||(s[2]=o=>i.priorytetSort=o)},Z,512),[[k,i.priorytetSort]])]),Y,K])):(c(),l("div",J,"Brak zgłoszeń")),t("ul",q,[(c(!0),l(y,null,S(i.output,o=>(c(),l("li",{key:o.id},[a.checkStatusSort(o)&&a.checkRodzajSort(o)&&a.checkPriorytetSort(o)?(c(),l("section",G,[t("div",{class:"tickets__tickets-list-item",onClick:s[3]||(s[3]=r=>a.showInfo(r))},[t("p",null,d(o.id),1),t("p",null,d(a.titleFormatingLength(o.title)),1),t("p",null,d(a.statusSet(o.ticketStatusId)),1),t("p",null,d(a.typeSet(o.ticketTypeId)),1),t("p",null,d(a.prioritySet(o.priorityId)),1),t("p",{class:z([{greenDate:o.timeLeft.slice(0,1)>0},"date"])},d(o.timeLeft),3),Q]),t("div",X,[i.isAdmin?(c(),l("div",$,[o.ticketStatusId!=4?(c(),l("button",{key:0,onClick:r=>a.changeStatusTicket(o.id,4,1)},"Zamknij zgłoszenie",8,tt)):u("",!0),o.ticketStatusId!=2?(c(),l("button",{key:1,onClick:r=>a.changeStatusTicket(o.id,2,2)},"Status w realizacji",8,et)):u("",!0),o.ticketStatusId!=3?(c(),l("button",{key:2,onClick:r=>a.changeStatusTicket(o.id,3,3)},"Status oczekujący",8,st)):u("",!0),i.isAdmin?(c(),l("button",{key:3,onClick:r=>a.deleteTicket(o.id)},"Usuń zgłoszenie",8,ot)):u("",!0)])):u("",!0),t("div",it,[nt,t("p",null,d(o.userName),1)]),t("div",rt,[at,t("p",null,d(a.formatISOTimeToHM(o.created))+" "+d(a.formatISODateToDMY(o.created)),1)]),t("div",ct,[lt,t("p",null,d(o.title),1)]),t("div",dt,[mt,t("p",null,d(o.description),1)]),o.comments[0]?(c(),l("div",ut,[t("p",{onClick:s[4]||(s[4]=r=>a.showComments(r))},[T(" Pokaż komentarze "),ht])])):u("",!0),o.comments[0]?(c(),l("div",_t,[t("ol",pt,[(c(!0),l(y,null,S(o.comments,(r,Mt)=>(c(),l("li",null,[t("div",kt,[t("p",ft,d(r.userName),1),t("div",gt,[t("p",yt,d(a.formatISOTimeToHM(r.createTime)),1),t("p",St,d(a.formatISODateToDMY(r.createTime)),1)])]),r.editingNow?u("",!0):(c(),l("em",{key:0,ref_for:!0,ref:"commentContent",class:"tickets__tickets-list-info-comments-list-content"},d(r.content),513)),r.editingNow?(c(),l("form",{key:1,onSubmit:f(p=>a.editComment(o.id,r.id,r.content),["prevent"]),class:"tickets__tickets-list-info-comments-list-edit-input"},[_(t("textarea",{style:C({height:`${e.$refs.commentContent}px`}),"onUpdate:modelValue":p=>r.content=p},null,12,zt),[[g,r.content]]),Tt],40,wt)):u("",!0),i.currentUserId==r.createdByUserId?(c(),l("div",Ct,[t("span",{onClick:p=>r.editingNow=!r.editingNow,class:"material-symbols-outlined edit"},"edit",8,vt),t("span",{onClick:p=>a.deleteComments(o.id,r.id),class:"material-symbols-outlined delete"},"delete",8,It)])):u("",!0)]))),256))]),t("form",{class:"tickets__tickets-list-info-comments-form",onSubmit:f(r=>a.addComment(o.id),["prevent"])},[_(t("textarea",{placeholder:"Dodaj komentarz ...","onUpdate:modelValue":r=>i.newComments[o.id]=r},null,8,jt),[[g,i.newComments[o.id]]]),Dt],40,Et)])):(c(),l("div",xt,[t("form",{class:"tickets__tickets-list-info-comments-form",onSubmit:f(r=>a.addComment(o.id),["prevent"])},[_(t("textarea",{placeholder:"Dodaj komentarz ...","onUpdate:modelValue":r=>i.newComments[o.id]=r},null,8,Nt),[[g,i.newComments[o.id]]]),At],40,bt)]))])])):u("",!0)]))),128))])])}const Bt=w(I,[["render",Ut]]);export{Bt as default};
